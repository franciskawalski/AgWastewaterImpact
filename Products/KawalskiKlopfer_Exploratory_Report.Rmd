---
title: 'Agricultural Water Reuse Policy: An Exploratory Analysis'
author: "Grant Klopfer, Francis Kawalski"
date: "2024-10-31"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

## Background

Water scarcity has been a growing issue for decades, especially with regards to agriculture. 2020 saw 3.2 billion people living in agricultural areas with high water scarcity per the United Nations (Water Scarcity, 2020). The UN also notes that water scarcity is projected to increase over time, an effect that–compounded with climate change–will put increasing pressure on food supplies (UN-Water, 2024). This factor is especially significant with 72% of water withdrawals globally being used for agriculture (UN-Water, 2021).

Solutions for water scarcity, therefore, are very important. One solution is the reuse of treated wastewater for irrigation in agriculture, which the EPA notes can create a "reliable, sustainable, and local water supply (EPA, 2024). Reznik et al. (2019) find that the reuse of treated wastewater can be both an "Efficient and sustainable solution for water resource scarcity". However, it is not a perfect solution. The reuse of wastewater can introduce contaminants including metals, salts, and nutrients. These factors can enter and damage both soil and water supplies (Yalin et al., 2023; Trotta et al., 2024).

Among these, nutrient pollution is especially concerning. Nutrient pollution is a type of water pollution consisting of excess compounds of nitrogen and phosphorus. Per the EPA, nutrient pollution is "One of America's most widespread, costly, and challenging environmental problems," (EPA, 2024). The EPA further notes that excess nitrogen pollution can be harmful to human health and wildlife populations: excess nitrogen in bodies of surface waters can cause algae blooms, which can release toxins harmful both to humans and wildlife. Nitrates (a nitrogen compound) can enter drinking water supplies, and can be harmful to humans–or fatal to infants–even in low levels. Mosheim and Sickles (2021) find that nutrient pollution can increase the production costs of water utilities, which is substantiated by EPA findings of water production costs increasing from ten cents per gallon treated up to four dollars per gallon with the installation of a nitrate reduction system (EPA, 2024).

## Data

Our analysis aims to shed light on this trade-off between a sustainable water supply and the reduction of nutrient pollution. We use panel data from several sources to conduct our analysis. Water quality data is collected from USGS and EPA water surveys compiled by the National Water Quality Monitoring Council. This data includes concentrations of nitrogen and nitrogen compounds in various bodies of surface and groundwater in milligrams/liter. Nitrogen is one of the most common aspects of water quality that states have regulations on , so we use this as our primary analysis. These observations were primarily identified by geographic coordinates, which were mapped to U.S. states using GIS data from the Census Bureau. Some observations that did not include coordinates were linked to states using the USGS state-level office that collected the data. This data covers years from 2000 through 2023, as that time period contains most water reuse quality regulations passed by states with such regulations.

The nature and exact specifications of each state's water reuse quality regulations was collected from the EPA's Regulations and End-Use Specifications Explorer (REUSExplorer). We focused primarily on the concentration regulations on nitrogen and nitrogen compounds. The concentrations are primarily measured in milligrams per liter, both in the state regulations and the water quality data. The year each of these regulations was registered with the EPA (or in cases where this information is not known, the most recent state-level regulation) was collected from both the EPA's REUSExplorer and each state's respective administrative code. For year of treatment, we used the year the EPA-recognized policy was established, though we also included the year in which each state first regulated wastewater reuse.

To capture any climate trends that may impact the amount of nitrogen used, we have also included data from the USDA Farm Production Regions. These regions are defined by state borders and capture similarity of crops, which is largely determined by climate.

In the final dataset, the unit of analysis is called *avgvalue*, and this variable contains the average quantity of a given nitrogen compound for each state and year combination. Our analysis looks primarily at nitrogen (as opposed to other compounds thereof) as it is the most consistently regulated by states. The distribution of average value of nitrogen is right-skewed, so a log transformation was applied to normalize the distribution and ease of interpretation.

Some extreme values became apparent during the visualization process. Some state wastewater reuse regulations were first passed long before the time-frame covered by our data (such as California's 1918 regulation). When we analyze average water quality across states relative to the year of treatment, we bin all observations over 10 years before and after the event. Additionally, due to fundamental differences in region, crop, and climate we decided to exclude Alaska and Hawaii from the analysis.

## Visualizations

```{r, echo = F, warning = F, message = F}
setwd("../Data/Clean")
dataWithoutCat = read_csv("stateAvgWithoutCat.csv")
ggplot(dataWithoutCat, aes(x = avgValue, fill = hasStateReg)) +
  geom_histogram(position = "identity", alpha = .5, bins  = 50) +
  theme_bw() +
  theme_minimal() +
  xlab("Nitrogen Concentration in mg/L (logged)") +
  ylab("Number of Observations") +
  labs(title = "Nitrogen Concentration by Regulation Status", fill = "State Has\nRegulations")+
  theme(plot.title = element_text(hjust = 0.5)) ##Center title
```

Our first figure displays distributions of nitrogen concentration for states with and without regulations on nitrogen levels in reused wastewater. This distribution is very right skewed, which led to our decision to log-transform the average nitrogen level variable.

```{r, echo = F, warning = F, message = F}
setwd("../Data/Clean")
dataWithoutCat = read_csv("stateAvgWithoutCat.csv")
ggplot(dataWithoutCat, aes(x = avgValue, fill = hasStateReg)) +
  geom_histogram(position = "identity", alpha = .5, bins  = 50) +
  scale_x_log10() +
  theme_bw() +
  theme_minimal() +
  xlab("Nitrogen Concentration in mg/L (logged)") +
  ylab("Number of Observations") +
  labs(title = "Nitrogen Concentration by Regulation Status", fill = "State Has\nRegulations")+
  theme(plot.title = element_text(hjust = 0.5)) ##Center title
```

The two log-transformed distributions show similar modes, though states with regulations trend towards higher concentrations. This could imply selection bias, as states with preexisting higher concentrations of nitrogen may be more likely to regulate its levels.

```{r, echo = F, warning = F, message = F}
setwd("../Data/Clean")
dataWithoutCat = read_csv("stateAvgWithoutCat.csv") |> 
  filter(state != "NH")

dataWithoutCat |> 
  filter(CharacteristicName == "Nitrogen") |> 
  group_by(year, hasStateReg) |> 
  summarise(avgVal = mean(avgValue, na.rm = T)) |> 
  ggplot(aes(x = year, y = avgVal, color = hasStateReg)) +
  geom_line() +
  scale_y_log10() + 
  theme_bw() +
  theme_minimal() +
  xlab("Year") +
  ylab("Nitrogen in mg/L (logged)") +
  labs(title = "Nitrogen Concentration Over time", color = "State Has\nRegulations") +
  theme(plot.title = element_text(hjust = 0.5)) ##Center title
```

Our second figure shows trends in nitrogen concentration over time for states with and without regulations on nitrogen concentration in reused wastewater. States with regulations have higher values of wastewater on average, and exhibit a slow increase over time. Unregulated states have lower levels of nitrogen concentration, though concentrations are increasing at a faster rate.

```{r, echo = F, warning = F, message = F}
setwd("../Data/Clean")
data = read_csv("cleanMergedData.csv") |> 
  select(-`...1`) |> 
  mutate(monthYear = as.yearmon(str_c(year, month), "%Y %m")) |> 
  rename(USDARegion = `USDA Farm Production Region`)


data |> 
  filter(CharacteristicName == "Nitrogen",
         hasStateReg) |>
  group_by(year, Specification, state, month) |> ##Combine state level data into only relevant categories
  summarize(avgVal = mean(avgValue, na.rm = T)) |> 
  mutate(Specification = ifelse(str_detect(Specification, "[0-9]"), "Specified Amount", Specification)) |> ##Group all nums together
  group_by(Specification, year) |> 
  summarise(avgVal = mean(avgVal)) |> 
  ggplot(aes(x = year, y = avgVal, color = Specification)) + 
  geom_line() +
  scale_y_log10() +
  theme_bw() +
  theme_minimal() +
  xlab("Year") +
  ylab("Nitrogen Concentration in mg/L (logged)") +
  labs(title = "Nitrogen Concentration by State Regulatory Specification", color = "Regulatory\nSpecification") +
  theme(plot.title = element_text(hjust = 0.5)) ##Center title
```

Our third figure shows how concentration varies over time by regulatory specification. Different states specify maximum allowed nitrogen concentrations differently. States specifying an "Agronomic Rate" specify acceptable concentrations depending on the need for a specific crop. "Specified Amounts" are specific, measured quantities of nitrogen that are acceptable. States without a specified amount measure, but do not restrict, concentrations of nitrogen in reused wastewater.

```{r, echo = F, warning = F, message = F}
setwd("../Data/Clean")
dataWithoutCat = read_csv("stateAvgWithoutCat.csv") |> 
  filter(state != "NH")

dataWithoutCat |> 
  filter(hasStateReg) |> 
  mutate(event = year - currentRegYear,
         event = ifelse(event > 9, 10, event),
         event = ifelse(event < -9, -10, event))  |> 
  ggplot(aes(x = event, y = avgValue)) +
  geom_point(alpha = .3, size = 2) +
  geom_vline(xintercept = 0) +
  geom_smooth() +
  theme_bw()+ 
  xlab("Years Relative to Treatment") +
  ylab("Nitrogen Concentration in mg/L (logged)") +
  labs(title = "Nitrogen Concentration Across Regulation Periods") +
  scale_y_log10(labels = scales::comma) +
  theme(plot.title = element_text(hjust = 0.5)) ##Center title
```

Our fourth figure shows individual observations of nitrogen concentrations over time, with time zero being the period when each observation's state enacted the EPA-registered restriction on water quality. Overall trends exhibit minimal change in average concentrations during treatment.

```{r, echo = F, warning = F, message = F}
setwd("../Data/Clean")
dataWithoutCat = read_csv("stateAvgWithoutCat.csv") |> 
  filter(state != "NH")

dataWithoutCat |> 
  ggplot(aes(x = avgValue, fill = USDARegion)) +
  geom_histogram(position = "Identity", alpha = .4, bins = 50)  +
  scale_x_log10(labels = scales::comma) +
  theme_bw() +
  xlab("Nitrogen Concentration in mg/L (logged)") +
  ylab("Number of Observations") +
  labs(title = "Nitrogen Concentrations by Region", 
       fill = "USDA Region")+
  theme(plot.title = element_text(hjust = 0.5)) ##Center title
```

Our final figure shows density of observations for different nitrogen concentrations by region. Concentration distributions change substantially by region. Regions of note include the Corn Belt, which contains a broad distribution of concentrations, and the Appalachian region with a bimodal distribution containing peaks at both low and moderately high concentration values.
